

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pymedextcore.doccanotransform &mdash; pymedextcore 0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/msmb.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/versions.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pymedextcore
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pymedextcore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pymedextcore.doccanotransform</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pymedextcore.doccanotransform</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">.document</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="kn">from</span> <span class="nn">.doccanodocument</span> <span class="kn">import</span> <span class="n">DoccanoDocument</span>

<span class="kn">from</span> <span class="nn">.annotators</span> <span class="kn">import</span> <span class="n">Annotator</span><span class="p">,</span> <span class="n">Annotation</span>
<span class="kn">from</span> <span class="nn">.doccanoannotator</span> <span class="kn">import</span> <span class="n">DoccanoAnnotation</span>

<span class="kn">from</span> <span class="nn">.datatransform</span> <span class="kn">import</span> <span class="n">DataTransform</span>


<div class="viewcode-block" id="Doccano"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano">[docs]</a><span class="k">class</span> <span class="nc">Doccano</span><span class="p">(</span><span class="n">DataTransform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines a set of transformation methods to build a DoccanoDocument with several pymedext Document objects.</span>
<span class="sd">    A doccanoDocument contains N doccanoAnnotations, that the user want to evaluate in Doccano interface.</span>

<span class="sd">    Here the transoformation methods are specific to scanner report extractions, and DrWH negation, hypothesis and family context detections.</span>
<span class="sd">    Other transformation methods could be defined according to what the user want to evaluate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># def load(DoccanoDocument):</span>
    <span class="c1">#     return Document</span>
    <span class="c1">#</span>
    <span class="c1"># def save(Docment, type=None, attribute= None, value=None, span=None, dict_regex_type = None, path_to_pb_doc = None, regex = None, which_kind_of_doccano = None ):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     :param type:</span>
    <span class="c1">#     :param attribute:</span>
    <span class="c1">#     :param value:</span>
    <span class="c1">#     :param span:</span>
    <span class="c1">#     :param which_kind_of_doccano:</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     if which_kind_of_doccano == &quot;ima_precision&quot; :</span>
    <span class="c1">#         dict_doccano = toDoccanoImaPrecision(Document, type=type, attribute=attribute)</span>
    <span class="c1">#</span>
    <span class="c1">#     elif which_kind_of_doccano == &quot;ima_rappel&quot;:</span>
    <span class="c1">#         dict_doccano = toDoccanoImaRappel(Document, dict_regex_type=dict_regex_type, value=value, span=span)</span>
    <span class="c1">#</span>
    <span class="c1">#     elif which_kind_of_doccano == &quot;ima_pb&quot;:</span>
    <span class="c1">#         dict_doccano = toDoccanoPb(Document, path_to_doc=path_to_pb_doc, regexp = regex)</span>
    <span class="c1">#</span>
    <span class="c1">#     else :</span>
    <span class="c1">#         print(&quot;Please enter the doccano eval you which to do.&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#     DoccanoDocument = docForDoccano(dict_doccano)</span>
    <span class="c1">#</span>
    <span class="c1">#     return DoccanoDocument</span>



<div class="viewcode-block" id="Doccano.toDoccanoImaPrecision"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.toDoccanoImaPrecision">[docs]</a>    <span class="k">def</span> <span class="nf">toDoccanoImaPrecision</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specific method for scanner extractor evaluation</span>
<span class="sd">        Selects the value extracted of the desired item in the pymedext Document.</span>
<span class="sd">        Returns a dict with the context as key, and the value extracted as value.</span>

<span class="sd">        Ex : Extract of a pymedextDocument  :</span>
<span class="sd">        &quot;</span>
<span class="sd">        ...</span>

<span class="sd">        {</span>
<span class="sd">            &quot;type&quot;: &quot;motif&quot;,</span>
<span class="sd">            &quot;value&quot;: &quot;non évocateur&quot;,</span>
<span class="sd">            &quot;span&quot;: [</span>
<span class="sd">                2026,</span>
<span class="sd">                2039</span>
<span class="sd">            ],</span>
<span class="sd">            &quot;source&quot;: &quot;annotator_section_img&quot;,</span>
<span class="sd">            &quot;source_ID&quot;: &quot;eae2fd1e-8096-11ea-9260-e470b8d2ff7c&quot;,</span>
<span class="sd">            &quot;isEntity&quot;: false,</span>
<span class="sd">            &quot;attributes&quot;: &quot;ISCOVID&quot;,</span>
<span class="sd">            &quot;id&quot;: &quot;eae2fd1c-8096-11ea-b180-e470b8d2ff7c&quot;</span>
<span class="sd">        }</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;</span>

<span class="sd">        An extract of pymedextDocument.toDoccanoImaPrecision(type=&quot;motif&quot;, attribute=&quot;ISCOVID&quot;) return will be :</span>

<span class="sd">        {...,&lt;raw_text[2026,2039]&gt; : &quot;non évocateur&quot;,...}</span>

<span class="sd">        where raw_text[2026,2039] is the context of the extraction, a short extract of the report text around the extraction.</span>

<span class="sd">        :param type: the type of the item (&quot;rubrique&quot; or &quot;motif&quot;)</span>
<span class="sd">        :param attribute: item of interest (ex : &quot;ISCOVID&quot;)</span>
<span class="sd">        :return: a dict with litteral context as key and value extracted as value</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## Les regexp sont dans attributes</span>


        <span class="n">objects_list</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attribute</span><span class="p">)</span>
        <span class="n">raw_text</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s2">&quot;raw_text&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">dict_doccano</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">objects_list</span><span class="p">:</span>
            <span class="n">dict_el</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;span&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">!=</span> <span class="s2">&quot;rubrique&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NULL&quot;</span> <span class="ow">and</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Valeur extraite :&quot;</span> <span class="o">+</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Snippet : </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">raw_text</span><span class="p">[</span>
                                                                                            <span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">70</span><span class="p">:</span><span class="n">span</span><span class="p">[</span>
                                                                                                             <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">70</span><span class="p">]</span>
                    <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NULL&quot;</span> <span class="ow">and</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Valeur extraite :&quot;</span> <span class="o">+</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Snippet : </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">raw_text</span><span class="p">[</span>
                                                                                            <span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

                    <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span>

        <span class="k">return</span> <span class="n">dict_doccano</span></div>


<div class="viewcode-block" id="Doccano.toDoccanoImaRappel"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.toDoccanoImaRappel">[docs]</a>    <span class="k">def</span> <span class="nf">toDoccanoImaRappel</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="n">dict_regexp_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specific method for scanner extractor evaluation</span>
<span class="sd">        Founds the absent item in a pymedext Document.</span>

<span class="sd">        :param dict_regexp_type: a dict of with the item as key (ex: &quot;ISCOVID&quot;) and their type as value (&quot;motif&quot; or &quot;rubrique&quot;)</span>
<span class="sd">        :param value: &quot;Null&quot;</span>
<span class="sd">        :return: A dict with the report text as key and a list of absent item as value</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">doccano_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">regexp</span> <span class="ow">in</span> <span class="n">dict_regexp_type</span><span class="p">:</span>

            <span class="n">objects_list</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="n">dict_regexp_type</span><span class="p">[</span><span class="n">regexp</span><span class="p">],</span> <span class="n">attributes</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                                                <span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">objects_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">raw_text</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s2">&quot;raw_text&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">raw_text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">doccano_dict</span><span class="p">:</span>
                    <span class="n">doccano_dict</span><span class="p">[</span><span class="n">raw_text</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">regexp</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">doccano_dict</span><span class="p">[</span><span class="n">raw_text</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">doccano_dict</span></div>

<div class="viewcode-block" id="Doccano.toDoccanoPb"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.toDoccanoPb">[docs]</a>    <span class="k">def</span> <span class="nf">toDoccanoPb</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="n">path_to_doc</span><span class="p">,</span> <span class="n">regexp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specific method for scanner extractor evaluation</span>
<span class="sd">        A specific format to display documents that were annoted with label &quot;problem&quot; in Doccano</span>

<span class="sd">        :param path_to_doc: the path to the doc that was annoted with problem label in Doccano</span>
<span class="sd">        :param regexp: the item of interest</span>
<span class="sd">        :return: a dict with the text report as key and the regex as value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">doccano_dict_pb</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">path_to_doc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path_to_doc</span><span class="p">)</span>
        <span class="n">raw_text</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s2">&quot;raw_text&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Valeur extraite : &quot;</span> <span class="o">+</span> <span class="n">regexp</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Texte du compte-rendu annoté probleme :</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">raw_text</span>

        <span class="n">doccano_dict_pb</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">path_to_doc</span><span class="p">,</span> <span class="n">regexp</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">doccano_dict_pb</span></div>


<div class="viewcode-block" id="Doccano.toDoccanoDrWH"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.toDoccanoDrWH">[docs]</a>    <span class="k">def</span> <span class="nf">toDoccanoDrWH</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">segment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specific method for DrWH evaluation</span>
<span class="sd">        Selects the drwh annotation and their value and creat a dict with syntagm/sentence as key and class value of the syntagm/sentence as value.</span>

<span class="sd">        Ex : Extract of a pymedextDocument</span>

<span class="sd">        &quot;</span>
<span class="sd">        ...</span>
<span class="sd">        {</span>
<span class="sd">            &quot;type&quot;: &quot;drwh_syntagms&quot;,</span>
<span class="sd">            &quot;value&quot;: &quot; Le patient présente un diabète de type II&quot;,</span>
<span class="sd">            &quot;span&quot;: [</span>
<span class="sd">                47,</span>
<span class="sd">                91</span>
<span class="sd">            ],</span>
<span class="sd">            &quot;source&quot;: &quot;DRWH_syntagms.v1&quot;,</span>
<span class="sd">            &quot;source_ID&quot;: &quot;74633e84-80a3-11ea-a7f6-180f76073bf2&quot;,</span>
<span class="sd">            &quot;isEntity&quot;: false,</span>
<span class="sd">            &quot;attributes&quot;: null,</span>
<span class="sd">            &quot;id&quot;: &quot;74633e89-80a3-11ea-a7f6-180f76073bf2&quot;</span>
<span class="sd">        }</span>
<span class="sd">        ...</span>

<span class="sd">        {</span>
<span class="sd">            &quot;type&quot;: &quot;drwh_negation&quot;,</span>
<span class="sd">            &quot;value&quot;: &quot;non negatif&quot;,</span>
<span class="sd">            &quot;span&quot;: [</span>
<span class="sd">                47,</span>
<span class="sd">                91</span>
<span class="sd">            ],</span>
<span class="sd">            &quot;source&quot;: &quot;DRWH_negation.v1&quot;,</span>
<span class="sd">            &quot;source_ID&quot;: &quot;74633e89-80a3-11ea-a7f6-180f76073bf2&quot;,</span>
<span class="sd">            &quot;isEntity&quot;: false,</span>
<span class="sd">            &quot;attributes&quot;: null,</span>
<span class="sd">            &quot;id&quot;: &quot;74633e95-80a3-11ea-a7f6-180f76073bf2&quot;</span>
<span class="sd">        }</span>
<span class="sd">        ...</span>

<span class="sd">        An extract of pymedextDocument.toDoccanoDrWH(type=dwh_negation, segment=dwh_syntagm) return will be:</span>

<span class="sd">        {...,&quot;Le patient présente un diabète de type II&quot;=&quot;non negatif&quot;...,}</span>

<span class="sd">        :param type: dwh type of class (&quot;dwh_negation&quot; or &quot;dwh_hypothesis&quot; or &quot;dwh_family&quot;)</span>
<span class="sd">        :param segment: syntagm or sentence (&quot;dwh_sentence&quot; or &quot;dwh_syntagm&quot;)</span>
<span class="sd">        :return: a dict with syntagm or sentence as key and class as value</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">objects_list</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="n">dict_source_ID</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dict_doccano</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">objects_list</span><span class="p">:</span>
            <span class="n">dict_el</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="n">source_ID</span> <span class="o">=</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;source_ID&quot;</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">dict_el</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="n">dict_source_ID</span><span class="p">[</span><span class="n">source_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># negatif ou non negatif</span>

        <span class="k">for</span> <span class="n">source_ID</span> <span class="ow">in</span> <span class="n">dict_source_ID</span><span class="p">:</span>
            <span class="n">list_uniq_result</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">target_id</span><span class="o">=</span><span class="n">source_ID</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">list_uniq_result</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">el</span><span class="p">)[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_source_ID</span><span class="p">[</span><span class="n">source_ID</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">dict_doccano</span></div>


<div class="viewcode-block" id="Doccano.docForDoccano"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.docForDoccano">[docs]</a>    <span class="k">def</span> <span class="nf">docForDoccano</span><span class="p">(</span><span class="n">dict_doccano</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creats a DoccanoDoc object with dict in input</span>

<span class="sd">        :return: DoccanoDocument object</span>
<span class="sd">        :rtype : DoccanoDocument</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thisDoccanoDoc</span> <span class="o">=</span> <span class="n">DoccanoDocument</span>
        <span class="n">thisDoccanoDoc</span><span class="o">.</span><span class="n">annotationsDoccano</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">dict_doccano</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]]</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pymedext_name&quot;</span><span class="p">:</span> <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">thisDoccanoDoc</span><span class="o">.</span><span class="n">doccanoAnnotation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DoccanoAnnotation</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                                       <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                                                                       <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">thisDoccanoDoc</span></div>


<div class="viewcode-block" id="Doccano.DoccanoEvalRappel"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.DoccanoEvalRappel">[docs]</a>    <span class="k">def</span> <span class="nf">DoccanoEvalRappel</span><span class="p">(</span><span class="n">DoccanoDocument</span><span class="p">,</span> <span class="n">dict_doccano</span><span class="p">,</span> <span class="n">path_to_doc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds DoccanoAnnotation objects to a DoccanoDocument object, with a dict created with toDoccanoImaRappel</span>

<span class="sd">        :param dict_doccano: a dict created with toDoccanoImaRappel method</span>
<span class="sd">        :param path_to_doc: the path of the pymedext doc that was used to create dict_doccano</span>
<span class="sd">        :return: DoccanoDocument object</span>
<span class="sd">        :rtype: DoccanoDocument</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path_to_doc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path_to_doc</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">dict_doccano</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pymedext_name&quot;</span><span class="p">:</span> <span class="n">path_to_doc</span><span class="p">}</span>
            <span class="n">DoccanoDocument</span><span class="o">.</span><span class="n">doccanoAnnotation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DoccanoAnnotation</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                     <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                                                     <span class="n">meta</span><span class="o">=</span><span class="n">meta</span>
                                                             <span class="p">))</span>
        <span class="k">return</span> <span class="n">DoccanoDocument</span></div>

<div class="viewcode-block" id="Doccano.DoccanoEvalN"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.DoccanoEvalN">[docs]</a>    <span class="k">def</span> <span class="nf">DoccanoEvalN</span><span class="p">(</span><span class="n">DoccanoDocument</span><span class="p">,</span> <span class="n">dict_doccano</span><span class="p">,</span> <span class="n">number_annoted</span><span class="p">,</span> <span class="n">number_eval</span><span class="p">,</span> <span class="n">path_to_doc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds DoccanoAnnotation objects to DoccaDocument until a specified number of evaluations.</span>

<span class="sd">        :param dict_doccano: A doccano dict that will be filled until it reachs the desired number of annotations.</span>
<span class="sd">        :param number_annoted: the number of evaluations desired.</span>
<span class="sd">        :param number_eval: the current number of annotation.</span>
<span class="sd">        :return: A list with the modified DoccanoDocument object, and the number of annotations</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">dict_doccano</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_annoted</span> <span class="o">&lt;</span> <span class="n">number_eval</span><span class="p">:</span>
                <span class="n">number_annoted</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">path_to_doc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path_to_doc</span><span class="p">)</span>
                <span class="c1"># print(&quot;inside DoccanoEvalN&quot;, number_annoted)</span>
                <span class="n">DoccanoDocument</span><span class="o">.</span><span class="n">doccanoAnnotation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DoccanoAnnotation</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                                 <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span> <span class="o">+</span> <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]],</span>
                                                                 <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pymedext_name&quot;</span><span class="p">:</span> <span class="n">path_to_doc</span><span class="p">}))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">DoccanoDocument</span><span class="p">,</span> <span class="n">number_annoted</span><span class="p">]</span></div>

<div class="viewcode-block" id="Doccano.DoccanoEvalClass"><a class="viewcode-back" href="../../pymedextcore.html#pymedextcore.doccanotransform.Doccano.DoccanoEvalClass">[docs]</a>    <span class="k">def</span> <span class="nf">DoccanoEvalClass</span><span class="p">(</span><span class="n">DoccanoDocument</span><span class="p">,</span> <span class="n">dict_doccano</span><span class="p">,</span> <span class="n">dictClasses</span><span class="p">,</span> <span class="n">number_eval</span><span class="p">,</span> <span class="n">path_to_doc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds doccano annotations to DoccanoDocument object until a specified number of evaluations for both classes.</span>

<span class="sd">        :param dict_doccano: A doccano dict that will be filled until the two classes reach the desired number of annotations</span>
<span class="sd">        :param dictClasses: A dict of doccano classes (ex : negatif vs non negatif) with their current occurences.</span>
<span class="sd">        :param number_eval: the number of evaluations desired</span>
<span class="sd">        :return: A list with the modified Doccano Object, and a dict of annotations classes, with their number</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">dict_doccano</span><span class="p">:</span>
            <span class="n">path_to_doc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path_to_doc</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dictClasses</span><span class="p">:</span>  <span class="c1"># on ne sait pas quelles sont les étiquettes</span>
                <span class="n">dictClasses</span><span class="p">[</span><span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">DoccanoDocument</span><span class="o">.</span><span class="n">doccanoAnnotation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DoccanoAnnotation</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                                 <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]],</span>
                                                                           <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pymedext_name&quot;</span><span class="p">:</span> <span class="n">path_to_doc</span><span class="p">}))</span>
            <span class="k">elif</span> <span class="n">dictClasses</span><span class="p">[</span>
                <span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">number_eval</span><span class="p">:</span>  <span class="c1"># si l&#39;étiquette n&#39;a pas le nombre désiré d&#39;évaluation, on l&#39;ajoute</span>
                <span class="n">dictClasses</span><span class="p">[</span><span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">DoccanoDocument</span><span class="o">.</span><span class="n">doccanoAnnotation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DoccanoAnnotation</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                                 <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">dict_doccano</span><span class="p">[</span><span class="n">text</span><span class="p">]],</span>
                                                                            <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pymedext_name&quot;</span><span class="p">:</span> <span class="n">path_to_doc</span><span class="p">}))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">DoccanoDocument</span><span class="p">,</span> <span class="n">dictClasses</span><span class="p">]</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Antoine Neuraz, William Digan, Ivan Lerner, Alice Rogier, David Baudoin, Anita Burgun, Nicolas Garcelon, Bastien Rance.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  <script>
    var versions_json_url = ''
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        0.2
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>